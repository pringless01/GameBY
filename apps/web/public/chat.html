<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Ticaret Oyunu Chat - Gerçek zamanlı sohbet">
    <meta name="theme-color" content="#1976D2">
    <title>Chat - Ticaret Oyunu</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/chat.css">
    <link rel="stylesheet" href="/css/navigation.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/assets/icon-192.png">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="/js/socket-client.js" as="script">
    <link rel="preload" href="/js/chat.js" as="script">
</head>
<body>
    <div class="mobile-container">
        
        <!-- Chat Container -->
        <div class="chat-container animate-slideUp">
            
            <!-- Chat Header -->
            <div class="chat-header">
                <h1 class="chat-title">
                    <span class="chat-icon" id="chat-icon">🌍</span>
                    <span id="chat-title-text">Global Chat</span>
                </h1>
                <div class="online-count">
                    <span id="online-count">0 kişi online</span>
                </div>
            </div>

            <!-- Chat Tabs -->
            <div class="chat-tabs">
                <button class="chat-tab active" data-tab="global" data-count="">
                    <span class="chat-tab-icon">🌍</span>
                    <span>Global</span>
                </button>
                <button class="chat-tab" data-tab="local" data-count="">
                    <span class="chat-tab-icon">🏠</span>
                    <span>Lokal</span>
                </button>
                <button class="chat-tab" data-tab="private" data-count="">
                    <span class="chat-tab-icon">👥</span>
                    <span>Özel</span>
                </button>
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages" id="chat-messages">
                
                <!-- Welcome Message -->
                <div class="info-message welcome-message">
                    🎉 Chat'e hoş geldin! Burada diğer oyuncularla ticaret yapabilir, 
                    işbirliği kurabilir ve mentorlardan yardım alabilirsin.
                </div>

                <!-- Example Messages (will be replaced by real messages) -->
                <div class="message-item bot-message">
                    <div class="message-header">
                        <div class="message-user">
                            <span class="message-user-name">🤖 Rehber Ali</span>
                            <span class="trust-badge trust-excellent message-user-trust">⭐ 200</span>
                        </div>
                        <div class="message-time">
                            <span>Az önce</span>
                            <div class="message-status"></div>
                        </div>
                    </div>
                    <div class="message-content">
                        Merhaba! Yeni başlayan arkadaşlar için bir ipucu: 
                        İlk önce odun kesip para biriktirin, sonra diğer oyuncularla ticaret yapmaya başlayın! 🌳💰
                    </div>
                    <div class="message-reactions">
                        <button class="reaction-button">👍 5</button>
                        <button class="reaction-button">❤️ 2</button>
                    </div>
                </div>

                <div class="message-item">
                    <div class="message-header">
                        <div class="message-user">
                            <span class="message-user-name">Ahmet Yılmaz</span>
                            <span class="trust-badge trust-good message-user-trust">⭐ 165</span>
                        </div>
                        <div class="message-time">
                            <span>2 dakika önce</span>
                            <div class="message-status"></div>
                        </div>
                    </div>
                    <div class="message-content">
                        10 adet odun satıyorum, kimse almak ister mi? Birim fiyat 15 TL. 
                        Güven puanım yüksek, işlemlerim her zaman güvenli! 🤝
                    </div>
                    <div class="message-reactions">
                        <button class="reaction-button">🔥 3</button>
                        <button class="reaction-button">💰 1</button>
                    </div>
                </div>

                <div class="message-item">
                    <div class="message-header">
                        <div class="message-user">
                            <span class="message-user-name">Fatma Şen</span>
                            <span class="trust-badge trust-medium message-user-trust">⭐ 145</span>
                        </div>
                        <div class="message-time">
                            <span>5 dakika önce</span>
                            <div class="message-status"></div>
                        </div>
                    </div>
                    <div class="message-content">
                        Yeni başladım, mentor arıyorum. Bana yardım edecek deneyimli biri var mı? 🙏
                    </div>
                    <div class="message-reactions">
                        <button class="reaction-button">🤝 4</button>
                        <button class="reaction-button">💪 2</button>
                    </div>
                </div>

                <!-- Typing Indicator (hidden by default) -->
                <div class="typing-indicator d-none" id="typing-indicator">
                    <span id="typing-user">Mehmet</span> yazıyor
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>

                <!-- Loading placeholder -->
                <div class="chat-loading d-none" id="chat-loading">
                    <div class="loading-spinner"></div>
                    <span>Mesajlar yükleniyor...</span>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="chat-input">
                <div class="chat-input-group">
                    <input 
                        type="text" 
                        id="message-input" 
                        placeholder="Mesaj yazın..."
                        maxlength="500"
                        autocomplete="off"
                        autocorrect="off"
                        spellcheck="true"
                    >
                    <div class="input-accessories">
                        <button class="emoji-button" onclick="toggleEmojiPicker()" title="Emoji ekle">
                            😊
                        </button>
                    </div>
                    <div class="char-counter" id="char-counter">0/500</div>
                </div>
                <button class="send-button" id="send-button" disabled title="Mesaj gönder">
                    <span id="send-icon">➤</span>
                </button>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="/" class="nav-item">
                <span class="icon">🏠</span>
                <span>Ana Sayfa</span>
            </a>
            <a href="/chat.html" class="nav-item active">
                <span class="icon">💬</span>
                <span>Chat</span>
            </a>
            <a href="/marketplace.html" class="nav-item">
                <span class="icon">🏪</span>
                <span>Pazar</span>
            </a>
            <a href="/profile.html" class="nav-item">
                <span class="icon">👤</span>
                <span>Profil</span>
            </a>
        </nav>
    </div>

    <!-- Emoji Picker Modal -->
    <div class="emoji-picker d-none" id="emoji-picker">
        <div class="emoji-picker-header">
            <h3>Emoji Seç</h3>
            <button class="close-emoji" onclick="closeEmojiPicker()">✕</button>
        </div>
        <div class="emoji-grid">
            <button class="emoji-item" onclick="insertEmoji('😊')">😊</button>
            <button class="emoji-item" onclick="insertEmoji('🎉')">🎉</button>
            <button class="emoji-item" onclick="insertEmoji('👍')">👍</button>
            <button class="emoji-item" onclick="insertEmoji('❤️')">❤️</button>
            <button class="emoji-item" onclick="insertEmoji('🔥')">🔥</button>
            <button class="emoji-item" onclick="insertEmoji('💰')">💰</button>
            <button class="emoji-item" onclick="insertEmoji('🤝')">🤝</button>
            <button class="emoji-item" onclick="insertEmoji('💪')">💪</button>
            <button class="emoji-item" onclick="insertEmoji('🙏')">🙏</button>
            <button class="emoji-item" onclick="insertEmoji('🌟')">🌟</button>
            <button class="emoji-item" onclick="insertEmoji('⚡')">⚡</button>
            <button class="emoji-item" onclick="insertEmoji('🎯')">🎯</button>
        </div>
    </div>

    <!-- Message Context Menu -->
    <div class="context-menu d-none" id="context-menu">
        <button class="context-item" onclick="replyToMessage()">↩️ Yanıtla</button>
        <button class="context-item" onclick="copyMessage()">📋 Kopyala</button>
        <button class="context-item" onclick="reportMessage()">🚨 Bildir</button>
    </div>

    <!-- User Profile Modal -->
    <div class="user-modal d-none" id="user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-user-name">Kullanıcı Profili</h3>
                <button class="close-modal" onclick="closeUserModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="user-avatar-large">👤</div>
                <div class="user-info">
                    <h4 id="modal-user-fullname">Ahmet Yılmaz</h4>
                    <span class="trust-badge trust-good" id="modal-user-trust">⭐ 165</span>
                    <p class="user-stats">
                        📊 150 işlem • 🤝 %95 başarı • 📅 2 ay önce katıldı
                    </p>
                </div>
                <div class="user-actions">
                    <button class="btn btn-primary" onclick="sendPrivateMessage()">💬 Mesaj Gönder</button>
                    <button class="btn btn-outline" onclick="viewUserProfile()">👤 Profil Görüntüle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection Status -->
    <div class="connection-status d-none" id="connection-status">
        <span class="status-text">Bağlantı koptu, yeniden bağlanıyor...</span>
        <div class="status-spinner"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js" crossorigin="anonymous"></script>
    <script src="/js/socket-client.js"></script>
    <script src="/js/chat.js"></script>
    <script src="/js/utils.js"></script>

    <style>
        /* Emoji Picker Styles */
        .emoji-picker {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-heavy);
            padding: var(--spacing-md);
            z-index: 1000;
            max-width: 300px;
            width: 90%;
        }

        .emoji-picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .emoji-picker h3 {
            margin: 0;
            font-size: var(--font-medium);
        }

        .close-emoji {
            background: none;
            border: none;
            font-size: var(--font-large);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-md);
        }

        .close-emoji:hover {
            background: rgba(0,0,0,0.1);
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: var(--spacing-xs);
        }

        .emoji-item {
            background: none;
            border: none;
            font-size: 24px;
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .emoji-item:hover {
            background: rgba(0,0,0,0.1);
            transform: scale(1.2);
        }

        /* Context Menu Styles */
        .context-menu {
            position: fixed;
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-medium);
            padding: var(--spacing-xs) 0;
            z-index: 1000;
            min-width: 150px;
        }

        .context-item {
            display: block;
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
            font-size: var(--font-small);
            transition: var(--transition-fast);
        }

        .context-item:hover {
            background: rgba(0,0,0,0.1);
        }

        /* User Modal Styles */
        .user-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: var(--spacing-md);
        }

        .modal-content {
            background: var(--bg-surface);
            border-radius: var(--radius-lg);
            max-width: 400px;
            width: 100%;
            overflow: hidden;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .modal-header h3 {
            margin: 0;
            font-size: var(--font-large);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: var(--font-large);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-md);
        }

        .close-modal:hover {
            background: rgba(0,0,0,0.1);
        }

        .modal-body {
            padding: var(--spacing-lg);
            text-align: center;
        }

        .user-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            margin: 0 auto var(--spacing-md);
        }

        .user-info h4 {
            margin: 0 0 var(--spacing-sm) 0;
            font-size: var(--font-large);
        }

        .user-stats {
            font-size: var(--font-small);
            color: var(--text-secondary);
            margin: var(--spacing-md) 0;
        }

        .user-actions {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--secondary-color);
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            z-index: 9999;
            animation: slideInDown 0.3s ease;
        }

        .status-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: var(--radius-full);
            animation: spin 1s linear infinite;
        }

        /* Mobile Optimizations */
        @media (max-width: 480px) {
            .emoji-picker {
                bottom: 80px;
                max-width: none;
                left: 10px;
                right: 10px;
                transform: none;
            }

            .emoji-grid {
                grid-template-columns: repeat(5, 1fr);
            }

            .user-modal {
                padding: var(--spacing-sm);
            }

            .user-actions {
                flex-direction: column;
            }
        }
    </style>
    
    <!-- Navigation Script -->
    <script src="/js/navigation.js"></script>
</body>
</html>
