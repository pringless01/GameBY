<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Admin Panel Giriş</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
 body {font-family: system-ui, Arial; background:#0d1117; color:#e6edf3; display:flex; align-items:center; justify-content:center; height:100vh; margin:0;}
 .card {background:#161b22; padding:32px; border-radius:12px; width:360px; box-shadow:0 4px 18px -2px rgba(0,0,0,.6);} 
 h1 {font-size:20px; margin:0 0 24px; text-align:center;}
 label {display:block; font-size:13px; margin-bottom:4px;}
 input {width:100%; padding:10px 12px; border:1px solid #30363d; background:#0d1117; color:#e6edf3; border-radius:6px; font-size:14px;}
 input:focus {outline:2px solid #1f6feb; outline-offset:0;}
 button {width:100%; background:#238636; border:none; padding:12px; color:#fff; font-weight:600; border-radius:6px; cursor:pointer; font-size:14px; margin-top:12px;}
 button:hover {background:#2ea043;}
 .error {color:#ff7979; font-size:13px; min-height:18px; margin-top:8px;}
 .info {font-size:12px; opacity:.8; margin-top:16px; text-align:center;}
 .hidden {display:none;}
</style>
</head>
<body>
  <div class="card" id="login-card">
    <h1>Admin Giriş</h1>
    <form id="login-form">
      <label for="username">Kullanıcı Adı</label>
      <input id="username" name="username" autocomplete="username" required />
      <label for="password">Şifre</label>
      <input id="password" name="password" type="password" autocomplete="current-password" required />
      <button type="submit">Giriş</button>
      <div class="error" id="error"></div>
    </form>
    <div class="info">İlk giriş: admin / admin — giriş sonrası şifre değişikliği zorunlu.</div>
  </div>

<script>
const form = document.getElementById('login-form');
const errBox = document.getElementById('error');
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  errBox.textContent='';
  const username = form.username.value.trim();
  const password = form.password.value;
  try {
  const res = await fetch('/api/admin-core/login', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({username, password})});
    const data = await res.json();
    if(!res.ok){ errBox.textContent = data.error || 'Giriş başarısız'; return; }
    if(data.force_reset || data.forcePasswordChange){
      location.href = '/change-password.html?token=' + encodeURIComponent(data.token);
      return;
    }
    localStorage.setItem('admin_token', data.token);
    location.href = '/panel.html';
  } catch(err){ errBox.textContent = 'Sunucu hatası'; }
});
</script>
</body>
</html>
