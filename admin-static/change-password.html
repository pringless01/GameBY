<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Şifre Değiştir</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
 body {font-family: system-ui, Arial; background:#0d1117; color:#e6edf3; display:flex; align-items:center; justify-content:center; height:100vh; margin:0;}
 .card {background:#161b22; padding:32px; border-radius:12px; width:360px; box-shadow:0 4px 18px -2px rgba(0,0,0,.6);} 
 h1 {font-size:20px; margin:0 0 24px; text-align:center;}
 label {display:block; font-size:13px; margin-bottom:4px;}
 input {width:100%; padding:10px 12px; border:1px solid #30363d; background:#0d1117; color:#e6edf3; border-radius:6px; font-size:14px;}
 input:focus {outline:2px solid #1f6feb; outline-offset:0;}
 button {width:100%; background:#238636; border:none; padding:12px; color:#fff; font-weight:600; border-radius:6px; cursor:pointer; font-size:14px; margin-top:12px;}
 button:hover {background:#2ea043;}
 .msg {font-size:13px; margin-top:12px; min-height:18px;}
</style>
</head>
<body>
  <div class="card">
    <h1>Şifre Değiştir</h1>
    <form id="cp-form">
      <label for="newPass">Yeni Şifre</label>
      <input id="newPass" type="password" required minlength="8" />
      <label for="newPass2">Yeni Şifre (Tekrar)</label>
      <input id="newPass2" type="password" required minlength="8" />
      <button type="submit">Kaydet</button>
      <div class="msg" id="msg"></div>
    </form>
  </div>
<script>
const params = new URLSearchParams(location.search);
const token = params.get('token');
if(!token){ document.getElementById('msg').textContent='Token eksik'; }
const form = document.getElementById('cp-form');
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const p1 = newPass.value;
  const p2 = newPass2.value;
  const msg = document.getElementById('msg');
  msg.textContent='';
  if(p1!==p2){ msg.textContent='Şifreler uyuşmuyor'; return; }
  try {
    const res = await fetch('/api/admin/change-password', {method:'POST', headers:{'Content-Type':'application/json', 'Authorization':'Bearer '+token}, body: JSON.stringify({newPassword:p1})});
    const data = await res.json();
    if(!res.ok){ msg.textContent = data.error||'Hata'; return; }
    msg.textContent='Şifre güncellendi, yönlendiriliyorsunuz...';
    setTimeout(()=> location.href='/login.html',1500);
  } catch(err){ msg.textContent='Sunucu hatası'; }
});
</script>
</body>
</html>
